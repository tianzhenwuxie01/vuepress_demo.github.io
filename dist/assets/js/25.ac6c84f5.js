(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{385:function(t,s,n){"use strict";n.r(s);var a=n(44),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h3",{attrs:{id:"_1-准备工作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-准备工作"}},[t._v("#")]),t._v(" 1 准备工作")]),t._v(" "),n("p",[t._v("服务器一台，配置要求不高，低配版就可以。"),n("br"),t._v("\nonedrive 网盘账号一个，家庭版、教育版或商业版都可以。"),n("br"),t._v("\n时间和耐心两斤。")]),t._v(" "),n("h3",{attrs:{id:"_2-简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-简介"}},[t._v("#")]),t._v(" 2 简介")]),t._v(" "),n("p",[t._v("主要有这么几类：")]),t._v(" "),n("ol",[n("li",[t._v("原版 oneindex：开山鼻祖，使用的人较多，安装方便。但是经常会白屏（API 被吞失效）")]),t._v(" "),n("li",[t._v("pyone：听说看片方便，有一键安装代码，容易失败")]),t._v(" "),n("li",[t._v("onelist：轻便简洁，不支持看视频和看图。另外该作者还有魔改版的 oneindex，优化了图片分类。")]),t._v(" "),n("li",[t._v("olaindex：界面精美，API 稳定，方便看图、看视频，支持多网盘。安装有点困难，本文的主角。")]),t._v(" "),n("li",[t._v("cuteone：听说功能多，但我没用过。")]),t._v(" "),n("li",[t._v("其他 oneindex 修改版：各种修改版其实挺多的，建议自己寻找合适的。")])]),t._v(" "),n("h3",{attrs:{id:"_3-正文开始"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-正文开始"}},[t._v("#")]),t._v(" 3 正文开始")]),t._v(" "),n("h4",{attrs:{id:"安装宝塔"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装宝塔"}},[t._v("#")]),t._v(" 安装宝塔")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.bt.cn/download/linux.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("宝塔"),n("OutboundLink")],1)]),t._v(" "),n("h4",{attrs:{id:"正式安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#正式安装"}},[t._v("#")]),t._v(" 正式安装")]),t._v(" "),n("p",[n("strong",[t._v("安装环境")])]),t._v(" "),n("ul",[n("li",[t._v("nginx+php")]),t._v(" "),n("li",[t._v("PHP >= 7.2")])]),t._v(" "),n("h4",{attrs:{id:"php-禁用函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#php-禁用函数"}},[t._v("#")]),t._v(" php 禁用函数")]),t._v(" "),n("p",[t._v("安装好宝塔后，进入软件设置，找到 php7.2，安装，然后打开设置，安装 fileinfo 和 opcache 这两个拓展。（如下图）")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217144548.png",alt:""}})]),t._v(" "),n("p",[t._v("在禁用函数中，分别禁用是 exec 、 shell_exec 、 proc_open 、proc_get_status 这四个函数。\n为防止失败，我们可以进行饱和式设置，即多删几个函数，防止接下来安装的时候出错。可以参考我的单子，只保留这些就可以了：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217144723.png",alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217144753.png",alt:""}})]),t._v(" "),n("p",[t._v("设置完后，在 PHP 服务中重启 php。一定要重启！一定要重启！一定要重启！")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217144813.png",alt:""}})]),t._v(" "),n("p",[t._v("这个宝塔面板已经默认自带了，但是为避免出错，我们进行饱和式设置，再执行一边.")]),t._v(" "),n("p",[t._v("接下来用 ssh（不建议直接宝塔的 ssh，推荐用云服务器的 ssh），一行一行分开输入以下代码，并执行：")]),t._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[t._v("curl "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("s https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//getcomposer.org/installer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" php\nmv composer.phar /usr/local/bin/composer\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("p",[t._v("在站点中新建一个网站，输入域名，不需要数据库，版本选择 php7（我这里用的是 7.3），截图里是错的。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217144847.png",alt:""}})]),t._v(" "),n("p",[t._v("这里坑很多，请配合填坑指南仔细观看。")]),t._v(" "),n("p",[t._v("新的 readme"),n("a",{attrs:{href:"https://github.com/WangNingkai/OLAINDEX",target:"_blank",rel:"noopener noreferrer"}},[t._v("new"),n("OutboundLink")],1)]),t._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[t._v("cd /www/wwwroot/你的域名\ngit clone https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//github.com/WangNingkai/OLAINDEX.git tmp\nmv tmp/.git .\nrm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rf tmp\ngit reset "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("hard\ncomposer install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("vvv  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Install Dependencies")]),t._v("\nchmod "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("R 777 storage "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Important！！！Ensure that the cache directory has read and write permissions")]),t._v("\nchown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("R www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("www * "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# this 'www' refer to the serve user group")]),t._v("\ncomposer run install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# installation app")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("cd /www/wwwroot/你的域名\nrm -rf *\ngit clone https://github.com/WangNingkai/OLAINDEX.git tmp\nmv tmp/.git .\nrm -rf tmp\ngit reset --hard composer install -vvv\nchmod -R 777 storage/\nchown -R www:www *php artisan od:install\nchmod 777 storage/app/config.json\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("p",[t._v("有好多次是因为禁用函数出的问题，再然后就是权限的问题。\n禁用函数我们通过饱和式设置，多删了几个函数，应该已经没有问题了，那我们接下来看第一行。")]),t._v(" "),n("p",[t._v("第 1 行：这里的域名一定要换成自己的域名，别傻乎乎的就复制上去了。\n第 5 行：这里如果出现了和下图一样的错误，那就是第一行的路径输入错误，请检查路径，重新开始。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217145610.png",alt:""}})]),t._v(" "),n("p",[t._v("第 6 行：执行完之后，一切顺利的话，应该是下图这个样子")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217145637.jpg",alt:""}})]),t._v(" "),n("p",[t._v("第 7 行：这里如果出错了，很大概率是禁用函数和 Composer 的问题，请重新输入有关安装 Composer 的代码。")]),t._v(" "),n("p",[t._v("第 8 行：这里的权限原本是 755，我改成了 777，或者可以在宝塔面板 - 文件中（/www/wwwroot / 你的域名 /）的目录下找到这个叫做 storage / 的文件下，手动设置权限为 777。或者干脆全部 777")]),t._v(" "),n("p",[t._v("第 10 行：输入代码后，会让你输入网站地址，一定要加上 https:// 接着会问你 yes 还是 no，我试了几遍，两个选项都没有区别，所以我选择了 no，接着就会给你默认的账号密码：账号 admin，密码 12345678")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217145713.png",alt:""}})]),t._v(" "),n("p",[t._v("第 12 行：这里是一个大坑，因为我们执行这句命令后会发现，返回的命令告诉我们 “设置出错，没有这个文件”。\n用命令 find storage 搜索了一下后发现，没有 config.json 这个文件，与之相近的是 example.config.json")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217145744.png",alt:""}})]),t._v(" "),n("p",[t._v("进入到宝塔面板 - 文件里查看之后，我们发现，在 storage/app / 这个目录下果然是没有 config.json 这个文件的，只有一个叫做 example.config.json 的文件。所以我推测，这里应该是版本更新后，官方教程和文件不匹配导致的一个 BUG。")]),t._v(" "),n("p",[t._v("现在我们有两个选项，把 example.config.json 改名为 config.json，然后执行 12 行的命令，或者直接修改第 12 行的命令。")]),t._v(" "),n("p",[t._v("按照我们宁愿多走一步 ，不愿多出一次错的思想，进行饱和式设置，把 example.config.json 复制一份到其他文件夹，改名为 config.json，再复制回来，将两个文件的权限都改为 755 或 777。")]),t._v(" "),n("p",[t._v("手动设置权限之后，就不需要再输入命令行了。达到下图的标准就可以了：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217145857.png",alt:""}})]),t._v(" "),n("p",[t._v("打开网站设置，在网站目录中，把运行目录改成 / public，关闭 “防跨站攻击 (open_basedir)”，然后重启 php7.2。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217145924.png",alt:""}})]),t._v(" "),n("p",[t._v("接着修改伪静态：")]),t._v(" "),n("p",[t._v("新版宝塔选择伪静态-选择"),n("code",[t._v("Laravel 5")]),t._v("即可")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("location / {\n      try_files $uri $uri//index.php$is_args$query_string;\n}\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217150055.png",alt:""}})]),t._v(" "),n("p",[t._v("设置 SSL，申请之后打开右上角 “强制 HTTPS”")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200217150222.png",alt:""}})]),t._v(" "),n("p",[t._v("网站--配置里--注释掉以下代码\n"),n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200823230451.png",alt:""}})]),t._v(" "),n("p",[t._v("然后就 ok 了\n输入 https:// 你的域名/admin 登录，将你的网站和 onedrive 账号相绑定。\n输入账号：admin，密码 12345678，进入到 API 申请页面。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/tianzhenwuxie01/gitpicgo/img/20200823230836.png",alt:""}})]),t._v(" "),n("h3",{attrs:{id:"常见错误"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见错误"}},[t._v("#")]),t._v(" 常见错误")]),t._v(" "),n("h4",{attrs:{id:"密码死活不对-忘记密码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#密码死活不对-忘记密码"}},[t._v("#")]),t._v(" 密码死活不对，忘记密码")]),t._v(" "),n("p",[t._v("进入对应目录执行\n"),n("code",[t._v("php artisan helper:reset-password")])]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/WangNingkai/OLAINDEX/issues/307",target:"_blank",rel:"noopener noreferrer"}},[t._v("iuess"),n("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);